<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Verse">

	<typeAlias alias="Note" type="net.todd.biblestudy.db.Note" />

	<resultMap id="noteResult" class="Note">
		<result property="noteId" column="N_ID" />
		<result property="name" column="N_NAME" />
		<result property="text" column="N_TEXT" />
		<result property="lastModified" column="N_LAST_MODIFIED" />
		<result property="createdTimestamp" column="N_CREATED" />
	</resultMap>

	<select id="getNoteByName" parameterClass="string" resultMap="noteResult">
		SELECT		*
		FROM		NOTES
		WHERE		N_NAME like #id#
	</select>

	<insert id="createNewNote" parameterClass="Note">
		INSERT INTO NOTES (
			N_NAME, N_TEXT, N_LAST_MODIFIED, N_CREATED
		) values (
			#name#, #text#, #lastModified#, #createdTimestamp#
		)
		
		<selectKey resultClass="int" keyProperty="noteId">
	    	SELECT @@IDENTITY AS ID
  		</selectKey>
	</insert>
	
	<update id="updateNote" parameterClass="Note">
		UPDATE	NOTES
		SET		N_ID=#noteId#,
				N_NAME=#name#,
				N_TEXT=#text#,
				N_LAST_MODIFIED=#lastModified#
		WHERE	N_ID=#noteId#
	</update>
	
	<delete id="deleteNote" parameterClass="Note">
		DELETE 
		FROM		NOTES
		WHERE		N_ID=#noteId#
	</delete>

	<select id="getAllNotes" resultMap="noteResult">
		SELECT		*
		FROM		NOTES
	</select>

</sqlMap>